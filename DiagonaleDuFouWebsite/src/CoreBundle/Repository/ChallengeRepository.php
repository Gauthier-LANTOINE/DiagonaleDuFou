<?php

namespace CoreBundle\Repository;

use GL\WebsiteAdminBundle\Entity\Member;

/**
 * ChallengeRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ChallengeRepository extends \Doctrine\ORM\EntityRepository
{
    /**
     * Récupère les défi n'ayant pas reçu de réponse pour un membre donné en paramêtre
     * 
     * @param Member $memberChallenged
     * @return array
     */
    public function getUnansweredChallenge(Member $memberChallenged)
    {
        $result = $this->createQueryBuilder('c')
                       ->where('c.memberChallenged = :memberChallenged')
                       ->setParameter('memberChallenged',$memberChallenged)
                       ->andWhere('c.challengeAccepted IS NULL')
                       ->orderBy('c.date', 'DESC')
                       ->getQuery()
                       ->getResult();
        
        return $result;
    }
    
    /**
     * Récupère les défis lancés par le joueur passé en paramêtre
     * 
     * @param Member $memberChallenger
     * @return array
     */
    public function getSendChallenge(Member $memberChallenger)
    {
        $result = $this->createQueryBuilder('c')
                       ->where('c.memberChallenger = :memberChallenger')
                       ->setParameter('memberChallenger',$memberChallenger)
                       ->andWhere('c.challengeAccepted IS NULL')
                       ->orderBy('c.date', 'DESC')
                       ->getQuery()
                       ->getResult();
        
        return $result;
    }
}
